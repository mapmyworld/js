var mmw;(()=>{var e={60:()=>{document.addEventListener("keydown",(function(e){!e.ctrlKey||38!=e.keyCode&&40!=e.keyCode?setTimeout((function(){e.stopPropagation(),mmw.map.handlers.handleEvent(e)})):function(e){let t=mmw.map.getZoom();if(-1==e&&t<1)return;let o=.25*e;mmw.map.zoomTo(t+o)}(38==e.keyCode?-1:1)}))}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{"use strict";o.r(a),o.d(a,{_common:()=>me,_control:()=>pe,_custom:()=>ue,_layer:()=>ce,_overlay:()=>le,_router:()=>de,_view:()=>ye,map:()=>he,marker:()=>Se,markerpopup:()=>xe,popup:()=>Le});var e={};o.r(e),o.d(e,{fetchData:()=>x,fetchJSON:()=>L,goHome:()=>v,loadScript:()=>S,params:()=>f,search:()=>w,setNav:()=>h,setType:()=>b});var t={};o.r(t),o.d(t,{bottombarEl:()=>E,collapse:()=>O,el:()=>k,headerEl:()=>C,loadInset:()=>T,makeCollapsible:()=>I,middleheaderEl:()=>P,rightbarEl:()=>_,rightheaderEl:()=>M});var r={};o.r(r),o.d(r,{initControls:()=>j});var n={};o.r(n),o.d(n,{addFillLayer:()=>F,addLineLayer:()=>B,addSymbolLayer:()=>N,enablePopup:()=>A});var i={};o.r(i),o.d(i,{moveObject:()=>q,objects:()=>K});var s={};o.r(s),o.d(s,{MAP_BASE:()=>V,loadMapScript:()=>te,mapId:()=>$,navId:()=>ee});var m={};o.r(m),o.d(m,{loadSources:()=>ie});var l=[{id:"sat-layer",type:"raster",source:"sat-tiles"}];let p=new pmtiles.Protocol;maplibregl.addProtocol("pmtiles",p.tile);let c="https://r2-public.protomaps.com/protomaps-sample-datasets/protomaps-basemap-opensource-20230408.pmtiles";const d=new pmtiles.PMTiles(c);p.add(d);const u=protomaps_themes_base.default("protomaps","dark");u.splice(0,12),u.splice(2,1),u.splice(14,1);var y=[...l,...u],g={id:"MMW",version:8,name:"Map My World",center:[0,0],zoom:0,glyphs:"https://cdn.protomaps.com/fonts/pbf/{fontstack}/{range}.pbf",sources:{"raster-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,minzoom:2,maxzoom:19,attribution:'Â© Tiles <a href="https://openstreetmap.org">OpenStreetMap</a>'},"sat-tiles":{type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,minzoom:2,maxzoom:19,attribution:'<a href="https://www.arcgis.com/index.html">Esri ArcGIS</a>'},protomaps:{type:"vector",url:"pmtiles://"+c,minzoom:2,maxzoom:19,attribution:'Powered by <a href="https://protomaps.com">Protomaps</a>'},terrainSource:{type:"raster-dem",tiles:['https://api.ellipsis-drive.com/v3/path/085f5e10-63b6-4e8f-a4c6-dce9689100d3/raster/timestamp/3179fa80-60ad-41c7-ae67-cdd5eeeca693/tile/{z}/{x}/{y}?style={"method":"terrainRgb", "parameters":{"alpha":1, "bandNumber":1} }'],tileSize:256}},terrain:{source:"terrainSource",exaggeration:1}};o(60);const f=new URLSearchParams(document.location.search);function v(){window.location.href=window.location.origin+window.location.pathname}function w(e,t){f.set(e,t),window.location.search="?"+f.toString()}function h(e){w("nav",e)}function b(e){w("type",e)}function S(e){var t=document.createElement("script");t.src=e,document.body.append(t)}async function x(e){let t=await fetch(e);return await t.text()}async function L(e){var t=await x(e);return JSON.parse(t)}var z,C=k("header"),P=k("middleheader"),M=k("rightheader"),_=k("rightbar"),E=k("bottombar");function k(e){return document.getElementById(e)}function I(e){e.addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;"none"===e.style.display?e.style.display="block":e.style.display="none"}))}function O(e){e.classList.toggle("active"),e.nextElementSibling.style.display="none"}function T(e){return z||((z=document.createElement("iframe")).classList="top right mmw-overlay mmw-overlay-group inset",document.body.append(z)),z.src=e,z}function j(){mmw.map.addControl(new maplibregl.NavigationControl({showCompass:!1}),"bottom-left"),mmw.map.addControl(new maplibregl.NavigationControl({visualizePitch:!0,showZoom:!1}),"bottom-left"),mmw.map.addControl(new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"bottom-left")}function N(e,t,o,a){var r=newSymbolLayer(e,t,o);mmw.map.addLayer(r),a&&A(e,a)}function A(e,t){var o=e+"-symbols";mmw.map.on("mouseenter",o,(e=>{mmw.map.getCanvas().style.cursor="pointer";const o=t(e);if(o){const t=e.features[0].geometry.coordinates.slice();for(;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;mmw.popup.setLngLat(t).setHTML(o).addTo(map)}})),mmw.map.on("mouseleave",o,(()=>{mmw.map.getCanvas().style.cursor="",mmw.popup.remove()}))}function F(e,t,o,a){var r,n=e+"-fills",i=newFillLayer(e,t,o,a);a&&(mmw.map.on("mousemove",n,(t=>{t.features.length>0&&(r&&mmw.map.setFeatureState({source:e,id:r},{hover:!1}),r=t.features[0].id,mmw.map.setFeatureState({source:e,id:r},{hover:!0}))})),mmw.map.on("mouseleave",n,(()=>{r&&mmw.map.setFeatureState({source:e,id:r},{hover:!1})}))),mmw.map.addLayer(i)}function B(e,t,o){var a=newLineLayer(e,t,o);mmw.map.addLayer(a)}var J,R,Z,D,G,H,W,U,K={},X=1,Y=50;function q(){if(routes&&-1!=Z){null==Z&&(Z=routes.length-1,D=0),R=routes[Z];var e=K[R.properties.object];if(e&&(J!=e&&(J?scene3js.remove(J.scene):W||Q(),J=e,R.properties.direction&&(J.scene.rotation.y=R.properties.direction*Math.PI/180),map.flyTo({center:geoJSONData[2].features[Z].geometry.coordinates,zoom:R.properties.zoom||zoom,pitch}),scene3js.add(J.scene)),Z>=0))if(X<Y)def_transform.translateX=W.x,def_transform.translateY=W.y,W.x=W.x+U.x,W.y=W.y+U.y,X+=1;else{if(X=1,(D+=1)==R.geometry.coordinates.length-1){if(-1==(Z-=1))return;R=routes[Z],D=0,map.flyTo({center:geoJSONData[2].features[Z].geometry.coordinates,zoom,pitch})}Q()}}}function Q(){G=maplibregl.MercatorCoordinate.fromLngLat(R.geometry.coordinates[D],0),H=maplibregl.MercatorCoordinate.fromLngLat(R.geometry.coordinates[D+1],0),W=G,Y=R.properties.steps||50,U={x:(H.x-G.x)/Y,y:(H.y-G.y)/Y}}var V="/maps/",$=f.get("id"),ee=f.get("nav");function te(e){S(V+e+"/"+e+".js")}$&&te($);let oe=f.get("src"),ae=f.get("view"),re=f.get("type"),ne="pin";function ie(){oe&&("inset"!=ae?("basic"==re?mmw.map.setZoom(16.5):mmw.map.setZoom(15.99),mmw.map.setPitch(60)):ne="pin-xs",mmw.map.loaded()?se(oe):mmw.map.on("load",(function(){se(oe)})))}async function se(e){var t,o;e=e.split(",");for(let o=0;o<e.length;o++){var a=e[o];if(a){var r=await L(a);(t=r.features[0])&&(mmw.map.addSource("source-"+o,{type:"geojson",data:r}),t.properties.height?mmw.map.addLayer(newExtrusionLayer("source-"+o)):(F("source-"+o,"",.5,.2),B("source-"+o,"",2)),N("source-"+o,ne,["get","name"]))}}"Polygon"==t.geometry.type&&(o=t.geometry.coordinates[0][0],mmw.map.flyTo({center:o}))}const me=e,le=t,pe=r,ce=n,de=i,ue=s,ye=m;let ge=f.get("z")||3.5,fe=f.get("lat")||22,ve=f.get("lng")||80,we=f.get("type");"basic"===we?g.layers=[{id:"basic-layer",type:"raster",source:"raster-tiles"}]:"satellite"===we?g.layers=l:"hybrid"===we?g.layers=y:"none"===we?g.layers=[]:b("basic");const he=new maplibregl.Map({container:"map",hash:!0,style:g,center:[ve,fe],zoom:ge,pitch:0,bearing:0,antialias:!0,maxPitch:85}),be=he._controls[0];he.removeControl(be),he.addControl(be,"bottom-left"),he.on("load",(()=>{be._compact=!0,be._updateCompact(),be._updateCompactMinimize()})),he.loadImage("img/pin-sm.png",((e,t)=>{he.addImage("pin",t),he.addImage("pin-xs",t,{pixelRatio:2})})),he.loadImage("img/pin-blue-sm.png",((e,t)=>{he.addImage("pin-blue",t),he.addImage("pin-blue-xs",t,{pixelRatio:2})}));const Se=new maplibregl.Marker,xe=new maplibregl.Popup({closeButton:!1});Se.setPopup(xe);const Le=new maplibregl.Popup({closeButton:!1,closeOnClick:!1})})(),mmw=a})();